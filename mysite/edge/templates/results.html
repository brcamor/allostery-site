{% extends 'base.html' %}

{% block header_text %} Protein Results: {{ pdb_id }} {% endblock %}

{% block header_sub_text %}

Source residues are: 
{% for residue in source_residues %} 
{{residue.0}} {{residue.1}}, 
{% endfor %}

{% endblock %}

{% block results %}

<div class="row" id="id_bond_pp_graph">
</div>

<script type=text/javascript>

  var margin = {top:20, right:20, bottom:20, left:40}
  var width = 600 - margin.right;
  var height = 400 - margin.top - margin.bottom

  var svg = d3.select("#id_bond_pp_graph")
              .append("svg")
              .attr("height", height + margin.top + margin.bottom)
              .attr("width", width + margin.left + margin.right)
              .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  svg.append("text") 
     .attr("class", "x label")
     .attr("x", width)
     .attr("y", height - 6)
     .style("text-anchor", "end")
     .text("Distance");

  svg.append("text")
     .attr("class", "y label")
     .attr("text-anchor", "end")
     .attr("y", 6)
     .attr("dy", ".75em")
     .attr("transform", "rotate(-90)")
     .attr("Perturbation Propensity")

  d3.csv("static/edge/{{distance_bond_pp_file}}", function(error, data) {
  if (error) {
     console.log(error);
  } else {
     console.log(data);

     var dataset = data.map(function(d) {return [d['bond_name'], +d['distance'], +d['pp']];});
     makeScatterPlot(dataset);
         }
  });
    
  function makeScatterPlot(dataset) {
 
  var xScale = d3.scale.linear()
                       .domain([0, d3.max(dataset, function(d) {return d[1];})])
                       .range([0, width]);
  
  var yScale = d3.scale.linear()
                       .domain([0, d3.max(dataset, function(d) { return d[2]; })])
                       .range([height, 0]);

  var xAxis = d3.svg.axis()
                    .scale(xScale)
                    .orient("bottom")

  var yAxis = d3.svg.axis()
                    .scale(yScale)
                    .orient("left")

  svg.append("g")
     .attr("class", "axis")
     .attr("transform", "translate(0," + height + ")")
     .call(xAxis);

  svg.append("g")
     .attr("class", "axis")
     .call(yAxis);

  var circles = svg.append("g")
                   .attr("id", "circles")
                   .attr("clip-path", "url(#chart_area)")
                   .selectAll("circle")
                   .data(dataset)
                   .enter()
                   .append("circle")
                   .on("mouseover", function(d) { 
                     d3.select(this)
                       .attr("fill", "red");
                   })
                   .on("mouseout", function(d) {
                     d3.select(this)
                       .attr("fill", "blue");
                   });
                   
                    

  circles.attr("cx", function(d) {
              return xScale(d[1]);
          })
         .attr("cy", function(d) {
              return yScale(d[2]);
          })
         .attr("r", 7)
         .attr("fill", "blue");

  circles.append("title")
      .text(function(d) {return d[0]; });

}

</script>

<table class="table table-striped table-hover" id="id_bond_pp_table">
  <caption>Top 10 bonds by perturbation propensity</caption>
  <thead>
  <tr>
    <th>Bond</th>
    <th>Perturbation Propensity</th>
  </tr>
  </thead>
  <tbody>
    {% for item in top_weak_bonds_pp %}
    <tr> 
      <td>{{item.0}}</td>
      <td>{{item.1}}</td> 
    </tr>
    {% endfor %}
  </tbody>
</table>  

<table class="table table-striped table-hover" id="id_residue_pp_table">
  <caption>Top 10 residues by perturbation propensity</caption>
  <thead>
  <tr>
    <th>Residue</th>
    <th>Perturbation Propensity</th>
  </tr>
  </thead>
  <tbody>
    {% for item in top_residues_pp %}
    <tr> 
      <td>{{item.0}}</td>
      <td>{{item.1}}</td> 
    </tr>
    {% endfor %}
  </tbody>
</table>  

{% endblock %}
